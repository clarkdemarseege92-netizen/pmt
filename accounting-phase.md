# 🧾 Accounting Module Build Roadmap（零售记账模块构建进度表）

> 本文档用于 **VS Code + Claude** 协作开发零售记账（Accounting）模块。
>
> 使用方式：
>
> * 每一个 Phase 都可以**单独复制给 Claude 作为指令**
> * 严格按 Phase 顺序推进，不要跳步
> * Claude 只负责当前 Phase，不做超出范围的实现

---

## 📌 项目背景（Claude 必须理解）

```text
这是一个多商户（merchant）国际化平台项目。

技术栈：
- Next.js (App Router)
- TypeScript
- Supabase (PostgreSQL + Auth + RPC)

业务前提：
- 商户有后台管理系统
- 平台存在订单系统（平台订单 ≠ 现金交易）
- 商户存在“钱包”，但【钱包仅用于支付平台服务费】
- 用户没有钱包功能
```

---

## 🎯 Accounting 模块总体目标

```text
构建一个国际化零售记账模块，用于记录商户的收入与支出。

数据来源包括：
1. 平台订单自动生成的销售收入
2. 商户手动录入的现金交易
3. 平台服务费从商户钱包扣款生成的支出记录

该模块需支持：
- 数据汇总
- 基础财务分析
- 商户后台展示
```

---

## 🟩 Phase 0：规则与边界确认（不写代码）

### Claude 指令

```text
在开始写代码之前，请确认以下规则并在回复中复述：

1. 商户钱包 ≠ 用户钱包
2. 钱包仅用于支付平台服务费
3. 钱包扣款必须自动生成“支出”记账记录
4. 平台生成的记账记录：
   - 商户不可编辑
   - 商户不可删除
5. 手动记账仅用于非平台交易（如现金）

请不要输出任何代码。
```

✅ 通过标准：Claude 能清晰复述业务边界

---

## 🟩 Phase 1：数据库 Schema 设计（仅 SQL）

### 目标

* 设计记账相关的数据表
* 明确表之间的关系

### Claude 指令

```text
请为 Supabase (PostgreSQL) 设计零售记账模块的数据表。

要求：
- 支持多商户（merchant_id）隔离
- 支持收入 / 支出
- 支持平台订单自动记账
- 支持手动记账
- 支持平台服务费钱包扣款记账

请输出：
1. CREATE TABLE SQL
2. 表关系说明（文字）

注意：
- 不要写前端代码
- 不要写 Next.js 代码
```

### 预期产出

* account_transactions
* account_categories
* merchant_wallets
* wallet_transactions

---

## 🟩 Phase 2：自动记账逻辑（平台订单 & 钱包）

### 目标

* 平台事件自动生成记账记录

### Claude 指令

```text
请实现自动记账的后端逻辑。

场景 1：平台订单完成
- 自动生成一条“收入”记账记录
- 关联订单 ID

场景 2：平台服务费扣款
- 从 merchant_wallets 扣除余额
- 自动生成一条“支出”记账记录
- 商户不可编辑该记录

技术要求：
- 使用 Supabase RPC 或 Server Action
- 使用数据库事务（transaction）

请只输出后端逻辑示例。
```

### 预期产出

* RPC / server action 示例
* 事务安全说明

---

## 🟩 Phase 3：商户手动记账（现金交易）

### 目标

* 支持商户手动录入非平台交易

### Claude 指令

```text
请实现商户手动记账功能（仅后端）。

功能要求：
- 商户可选择：
  - 收入 / 支出
  - 类目
  - 金额
  - 备注
  - 关联商品或优惠券（可选）
- 不影响平台订单
- 不影响商户钱包余额

请输出：
- API 或 Server Action 示例
- 基础参数校验逻辑
```

---

## 🟩 Phase 4：财务汇总与分析（数据层）

### 目标

* 提供可供仪表盘使用的统计数据

### Claude 指令

```text
请实现零售记账模块的财务汇总查询逻辑。

需要的统计包括：
- 日 / 月 / 年收入
- 支出汇总
- 净利润
- 按类目汇总
- 平台服务费支出占比

请提供：
- SQL 查询示例
- 或 Supabase RPC 示例

不要实现前端 UI。
```

---

## 🟩 Phase 5：商户后台 UI（最后阶段）

### 目标

* 在商户后台展示记账与分析数据

### Claude 指令

```text
基于 Next.js App Router，实现商户后台的记账页面。

页面包括：
1. 记账记录列表
2. 手动记账弹窗
3. 财务汇总卡片（收入 / 支出 / 净额）

UI 规则：
- 钱包扣款记录只读
- 平台自动生成的记录不可编辑、不可删除

请输出：
- 页面结构示例
- 关键组件代码
```



✅ **本文件是 Accounting 模块的唯一权威构建进度表**
